#!/usr/bin/env bash

set -eu -o pipefail
source "$(dirname "$0")/utils.sh"

install_python() {
  local install_type=$1
  local version=$2
  local install_path=$3

  if [ "$install_type" != "version" ]; then
    echoerr "Cannot install specific ref from source, sorry."
    echoerr "For a list of available versions, see \`asdf list-all python\`."
    exit 1
  fi
  
  install_or_update_uv
  echo "uv python install $version -i $install_path"
  uv python install "$version" -i $install_path
}

install_default_python_packages() {
  local packages_file="${ASDF_PYTHON_DEFAULT_PACKAGES_FILE:-$HOME/.default-python-packages}"

  if [ -f "$packages_file" ]; then
    echo -ne "\nInstalling default python packages..."
    PATH="$ASDF_INSTALL_PATH/bin:$PATH" pip install -U -r "$packages_file"
  fi
}

ensure_uv_installed
install_python "$ASDF_INSTALL_TYPE" "$ASDF_INSTALL_VERSION" "$ASDF_INSTALL_PATH"
install_default_python_packages
